#
# NYRO 主配置文件
#

# ============================================================
# Nginx 核心配置
# ============================================================
nginx:
  # Worker 进程配置
  worker_processes: auto
  worker_connections: 10620
  worker_rlimit_nofile: 20480
  worker_shutdown_timeout: 3

  # 日志配置
  error_log: logs/error.log
  access_log: logs/access.log

  # DNS 解析器
  resolver:
    - 8.8.8.8
    - 114.114.114.114
  resolver_ipv6: false

  # 请求体大小限制 (0 = 无限制)
  client_max_body_size: 0

  # 代理监听端口
  http_listen:
    - 10080
  https_listen:
    - 10443

  # SSL/TLS 说明:
  #   - 占位证书 (ssl_certificate) 由 nyro 启动时自动生成
  #   - 业务证书通过 conf/config.yaml 中的 certificates 动态管理
  #   - ssl_certificate_by_lua_block 在运行时按 SNI 匹配并设置证书

  # Lua 共享内存区配置
  shared_dict:
    plugin_limit_conn: 50m
    plugin_limit_req: 50m
    plugin_limit_count: 50m
    upstream_health_check: 10m
    upstream_worker_event: 10m
    prometheus_metrics: 10m
    worker_events: 10m

# ============================================================
# 存储模式配置
# ============================================================
# 模式选择:
#   - standalone: DB Less 模式，从 YAML 文件加载配置
#   - hybrid: CP/DP 分离模式，从 Control Plane 同步配置 (未来支持)
store:
  mode: standalone
  
  # Standalone 模式配置 (DB Less)
  standalone:
    # 声明式配置文件路径 (相对于 nginx prefix)
    config_file: conf/config.yaml
    
    # 热加载方式: signal | admin_api | watch
    # - signal: 通过 HUP 信号触发
    # - admin_api: 通过 Admin API 触发
    # - watch: 文件变更自动加载 (需要 inotify 支持)
    reload_method: signal

  # Hybrid 模式配置 (未来支持)
  # hybrid:
  #   role: dp  # cp | dp
  #   control_plane:
  #     endpoints:
  #       - http://cp-1.nyro.local:9080
  #       - http://cp-2.nyro.local:9080
  #     sync_interval: 5
  #   mongodb:
  #     uri: mongodb://localhost:27017
  #     database: nyro

# ============================================================
# 插件列表
# ============================================================
plugins:
  - cors
  - mock
  - key-auth
  - jwt-auth
  - limit-req
  - limit-conn
  - limit-count
  # - ai-proxy  # AI Proxy 插件 (未来支持)

# ============================================================
# 日志配置
# ============================================================
logging:
  level: info       # debug | info | warn | error

# ============================================================
# Admin API 配置
# ============================================================
admin:
  # 是否启用 Admin API (standalone 模式下通常禁用)
  enabled: false
  # Admin API 监听端口列表
  listen:
    - 11080
    - 11443
